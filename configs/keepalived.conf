#
# Simple script for multi-primary setups
#

global_defs {
!	notification_email {
!		quentin@armitage.org.uk
!	}
!	notificaction_email_from keepalived@asenath.armitage.org.uk
!	smtp_server 172.21.53.209
!	smtp_connect_timeout 30
	vrrp_garp_master_delay 0
	vrrp_garp_master_repeat 1
	vrrp_garp_master_refresh 0
	vrrp_garp_master_refresh_repeat 2

!	vrrp_version 3

	vrrp_iptables TESTIN # TESTOUT
vrrp_check_unicast_src
}

    static_ipaddress {
        1.3.3.5/24 dev eth0
	2.4.4.6/24
!	3.5.5.7/24
	4.6.6.8/24
        }

!vrrp_sync_group VG_1 { # must be before vrrp_instance declaration
!  group {
!!    VI_1
!    VI_2
!!    VI_3
!!    VI_4
!    VI_6
!VI_7
!  }
!    notify_master "/etc/conntrackd/primary-backup.sh primary 1"
!    notify_backup "/etc/conntrackd/primary-backup.sh backup 1"
!    notify_fault "/etc/conntrackd/primary-backup.sh fault 1"
!}

!vrrp_instance VI_1 {
!    interface eth1
!    state BACKUP
!    virtual_router_id 6
!!    notify_new_vmac "${_PWD}/if_up vrrp.6"
!    use_vmac
!#    vmac_xmit_base
!    priority 10
!    advert_int 1
!!    authentication {
!!      auth_type PASS
!!      auth_pass papas_con_tomate
!!    }
!    virtual_ipaddress {
!      92.27.6.30/24 brd 92.27.6.255
!    }
!!    smtp_alert
!    notify_master "/etc/conntrackd/primary-backup.sh primary eth1 6 null 92.27.6.30"
!    notify_backup "/etc/conntrackd/primary-backup.sh backup eth1 6 null 92.27.6.30"
!    notify_fault "/etc/conntrackd/primary-backup.sh fault eth1 6 null 92.27.6.30"
!}

vrrp_instance VI_2 {
!    interface eth0.53
    interface eth0.60
    state BACKUP
    virtual_router_id 253
!    notify_new_vmac "${_PWD}/if_up vrrp.53"
    use_vmac
#    vmac_xmit_base
    priority 210
    advert_int 1
!    authentication {
!      auth_type PASS
!      auth_pass papas_con_tomate
!    }
    virtual_ipaddress {
      172.21.60.39/24 brd 172.21.60.255
      172.21.70.32/24 brd 172.21.70.255 label bert
      172.21.70.101/24 brd 172.21.70.255 label fred
      172.21.70.110/24 brd 172.21.70.255
    }
    virtual_ipaddress {
      172.21.70.111/24 brd 172.21.70.255
      172.21.70.112/24 brd 172.21.70.255
      172.21.70.113/24 brd 172.21.70.255
      172.21.70.114/24 brd 172.21.70.255
      172.21.70.115/24 brd 172.21.70.255
      172.21.70.116/24 brd 172.21.70.255
      172.21.70.117/24 brd 172.21.70.255
      172.21.70.118/24 brd 172.21.70.255
      172.21.70.119/24 brd 172.21.70.255
      172.21.70.120/24 brd 172.21.70.255
    }
    virtual_ipaddress_excluded {
      172.21.80.112/24 brd 172.21.80.255
      172.21.81.132/24 brd 172.21.81.255
    }
!    smtp_alert
!    notify_master "/etc/conntrackd/primary-backup.sh primary eth0.53 53 null 172.21.53.32"
!    notify_backup "/etc/conntrackd/primary-backup.sh backup eth0.53 53 null 172.21.53.32"
!    notify_fault "/etc/conntrackd/primary-backup.sh fault eth0.53 53 null 172.21.53.32"
}

vrrp_instance VI_6 {
!    interface eth0.53
    native_ipv6
    interface eth0.60
    state BACKUP
    virtual_router_id 253
!    accept
!    notify_new_vmac "${_PWD}/if_up vrrp.53"
#     use_vmac vrrp6.253
    use_vmac
#    vmac_xmit_base
    priority 10
    advert_int 1
!    authentication {
!      auth_type PASS
!      auth_pass papas_con_tomate
!    }
    virtual_ipaddress {
      2001:470:69dd:60::4234
      2001:470:69dd:60::5345
    }
    virtual_ipaddress_excluded {
      2001:470:69dd:60::4235
      2001:470:69dd:60::5346
    }
!    smtp_alert
!    notify_master "/etc/conntrackd/primary-backup.sh primary eth0.53 53 null 2001:470:69dd:35::fffd"
!    notify_backup "/etc/conntrackd/primary-backup.sh backup eth0.53 53 null 2001:470:69dd:35::fffd"
!    notify_fault "/etc/conntrackd/primary-backup.sh fault eth0.53 53 null 2001:470:69dd:35::fffd"
}

vrrp_instance VI_7 {
!    interface eth0.53
    interface eth0.60
    state BACKUP
    virtual_router_id 243
!    notify_new_vmac "${_PWD}/if_up vrrp.53"
    use_vmac
#    vmac_xmit_base
    priority 210
    advert_int 1
!    authentication {
!      auth_type PASS
!      auth_pass papas_con_tomate
!    }
    mcast_src_ip 172.21.70.132
    virtual_ipaddress {
      172.21.60.38/24 brd 172.21.60.255
#      172.21.70.38/24 brd 172.21.70.255
    }
    virtual_ipaddress_excluded {
      172.21.60.38/24 brd 172.21.60.255
#      172.21.70.38/24 brd 172.21.70.255
    }
!    smtp_alert
!    notify_master "/etc/conntrackd/primary-backup.sh primary eth0.53 53 null 172.21.53.32"
!    notify_backup "/etc/conntrackd/primary-backup.sh backup eth0.53 53 null 172.21.53.32"
!    notify_fault "/etc/conntrackd/primary-backup.sh fault eth0.53 53 null 172.21.53.32"
}

vrrp_instance VI_8 {
!    interface eth0.53
    interface eth0.60
    state BACKUP
    virtual_router_id 233
!    notify_new_vmac "${_PWD}/if_up vrrp.53"
!    use_vmac
#    vmac_xmit_base
    priority 210
    advert_int 1
!    authentication {
!      auth_type PASS
!      auth_pass papas_con_tomate
!    }
!!!    mcast_src_ip 172.21.70.132
    unicast_peer {
	10.21.60.14
    }
    virtual_ipaddress {
      172.21.160.38/24 brd 172.21.160.255
      172.21.170.38/24 brd 172.21.170.255
    }
    virtual_ipaddress_excluded {
      172.21.160.38/24 brd 172.21.160.255
      172.21.170.38/24 brd 172.21.170.255
    }
!    smtp_alert
!    notify_master "/etc/conntrackd/primary-backup.sh primary eth0.53 53 null 172.21.53.32"
!    notify_backup "/etc/conntrackd/primary-backup.sh backup eth0.53 53 null 172.21.53.32"
!    notify_fault "/etc/conntrackd/primary-backup.sh fault eth0.53 53 null 172.21.53.32"
}

vrrp_instance VI_9 {
!    interface eth0.53
    interface eth0.60
##    state BACKUP
    state MASTER
    virtual_router_id 233
!    notify_new_vmac "${_PWD}/if_up vrrp.53"
!    use_vmac
#    vmac_xmit_base
##    priority 10
    priority 255
    advert_int 1
!    authentication {
!      auth_type PASS
!      auth_pass papas_con_tomate
!    }
!!!    mcast_src_ip 172.21.70.132
     unicast_src_ip 2001:470:69dd:60::20
    unicast_peer {
	2001:470:69dd:60::14
    }
    virtual_ipaddress {
      2001:470:69dd:160::4234
      2001:470:69dd:160::5345
    }
    virtual_ipaddress_excluded {
      2001:470:69dd:160::4235
      2001:470:69dd:160::5346
    }
!    smtp_alert
!    notify_master "/etc/conntrackd/primary-backup.sh primary eth0.53 53 null 172.21.53.32"
!    notify_backup "/etc/conntrackd/primary-backup.sh backup eth0.53 53 null 172.21.53.32"
!    notify_fault "/etc/conntrackd/primary-backup.sh fault eth0.53 53 null 172.21.53.32"
}

!vrrp_instance VI_3 {
!    interface wlan1
!    state BACKUP
!    virtual_router_id 50
!!    notify_new_vmac "${_PWD}/if_up vrrp.50"
!    use_vmac
!#    vmac_xmit_base
!    priority 10
!    advert_int 1
!!    authentication {
!!      auth_type PASS
!!      auth_pass papas_con_tomate
!!    }
!    virtual_ipaddress {
!      172.21.53.32/24 brd 172.21.53.255
!    }
!!    smtp_alert
!    notify_master "/etc/conntrackd/primary-backup.sh primary eth0.50 50 null 172.21.50.30"
!    notify_backup "/etc/conntrackd/primary-backup.sh backup eth0.50 50 null 172.21.50.30"
!    notify_fault "/etc/conntrackd/primary-backup.sh fault eth0.50 50 null 172.21.50.30"
!}

!vrrp_instance VI_4 {
!    interface eth0.52
!    state BACKUP
!    virtual_router_id 52
!!    notify_new_vmac "${_PWD}/if_up vrrp.52"
!    use_vmac
!#    vmac_xmit_base
!    priority 10
!    advert_int 1
!!    authentication {
!!      auth_type PASS
!!      auth_pass papas_con_tomate
!!    }
!    virtual_ipaddress {
!      172.21.52.30/24 brd 172.21.52.255
!    }
!!    smtp_alert
!    notify_master "/etc/conntrackd/primary-backup.sh primary eth0.52 52 null 172.21.52.30"
!    notify_backup "/etc/conntrackd/primary-backup.sh backup eth0.52 52 null 172.21.52.30"
!    notify_fault "/etc/conntrackd/primary-backup.sh fault eth0.52 52 null 172.21.52.30"
!}
