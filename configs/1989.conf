@low net_namespace low
@high net_namespace high

global_defs {
        vrrp_version 3
}

vrrp_script chk_manual_failover {
        script "/usr/libexec/keepalived/nginx-ha-manual-failover"
        interval 10
        weight 50
}

vrrp_script chk_nginx_service {
        script "/usr/libexec/keepalived/nginx-ha-check"
        interval 3
        weight 50
}

vrrp_instance VI_1 {
#        interface ens192
        interface eth0
        priority 101
        virtual_router_id 51
        advert_int 1
        accept
        garp_master_refresh 5
        garp_master_refresh_repeat 1
#       unicast_src_ip 10.162.84.5
#       unicast_peer {
#                10.162.84.6
#       }
@low    unicast_src_ip 10.1.0.3
@high    unicast_src_ip 10.1.0.1
        unicast_peer {
@^high		10.1.0.1
@^low		10.1.0.3
        }
        virtual_ipaddress {
                10.162.84.7
                10.162.84.8
                10.162.84.9
                10.162.84.10
                10.162.84.11
                10.162.84.12
                10.162.84.13
                10.162.84.14
                10.162.84.15
                10.162.84.16
                10.162.84.17
                10.162.84.18
                10.162.84.19
                10.162.84.20
                10.162.84.21
                10.162.84.22
                10.162.84.23
                10.162.84.24
                10.162.84.25
                10.162.84.26
                10.162.84.27
                10.162.84.28
                10.162.84.29
                10.162.84.30
                10.162.84.31
                10.162.84.32
                10.162.84.33
                10.162.84.34
                10.162.84.35
                10.162.84.36
                10.162.84.37
                10.162.84.38
                10.162.84.39
                10.162.84.40
                10.162.84.41
                10.162.84.42
                10.162.84.43
                10.162.84.44
                10.162.84.45
                10.162.84.46
                10.162.84.47
                10.162.84.48
                10.162.84.49
                10.162.84.50
                10.162.84.51
                10.162.84.52
                10.162.84.53
                10.162.84.54
                10.162.84.55
                10.162.84.56
                10.162.84.57
                10.162.84.58
                10.162.84.59
                10.162.84.60
                10.162.84.61
                10.162.84.62
                10.162.84.63
                10.162.84.64
                10.162.84.65
                10.162.84.66
                10.162.84.67
                10.162.84.68
                10.162.84.69
                10.162.84.70
                10.162.84.71
                10.162.84.72
                10.162.84.73
                10.162.84.74
                10.162.84.75
                10.162.84.76
                10.162.84.77
                10.162.84.78
                10.162.84.79
                10.162.84.80
                10.162.84.81
                10.162.84.82
                10.162.84.83
                10.162.84.84
                10.162.84.85
                10.162.84.86
                10.162.84.87
                10.162.84.88
                10.162.84.89
                10.162.84.90
                10.162.84.91
                10.162.84.92
                10.162.84.93
                10.162.84.94
                10.162.84.95
                10.162.84.96
                10.162.84.97
                10.162.84.98
                10.162.84.99
                10.162.84.100
                10.162.84.101
                10.162.84.102
                10.162.84.103
                10.162.84.104
                10.162.84.105
                10.162.84.106
                10.162.84.107
                10.162.84.108
                10.162.84.109
                10.162.84.110
                10.162.84.111
                10.162.84.112
                10.162.84.113
                10.162.84.114
                10.162.84.115
                10.162.84.116
                10.162.84.117
                10.162.84.118
                10.162.84.119
                10.162.84.120
                10.162.84.121
                10.162.84.122
                10.162.84.123
                10.162.84.124
                10.162.84.125
                10.162.84.126
                10.162.84.127
                10.162.84.128
                10.162.84.129
                10.162.84.130
                10.162.84.131
                10.162.84.132
                10.162.84.133
                10.162.84.134
                10.162.84.135
                10.162.84.136
                10.162.84.137
                10.162.84.138
                10.162.84.139
                10.162.84.140
                10.162.84.141
                10.162.84.142
                10.162.84.143
                10.162.84.144
                10.162.84.145
                10.162.84.146
                10.162.84.147
                10.162.84.148
                10.162.84.149
                10.162.84.150
                10.162.84.151
                10.162.84.152
                10.162.84.153
                10.162.84.154
                10.162.84.155
                10.162.84.156
                10.162.84.157
                10.162.84.158
                10.162.84.159
                10.162.84.160
                10.162.84.161
                10.162.84.162
                10.162.84.162
                10.162.84.164
                10.162.84.165
                10.162.84.166
                10.162.84.167
                10.162.84.168
                10.162.84.169
                10.162.84.170
                10.162.84.171
                10.162.84.172
                10.162.84.173
                10.162.84.174
                10.162.84.175
                10.162.84.176
                10.162.84.177
                10.162.84.178
                10.162.84.179
                10.162.84.180
                10.162.84.181
                10.162.84.182
                10.162.84.183
                10.162.84.184
                10.162.84.185
                10.162.84.186
                10.162.84.187
                10.162.84.188
                10.162.84.189
                10.162.84.190
                10.162.84.191
                10.162.84.192
                10.162.84.193
                10.162.84.194
                10.162.84.195
                10.162.84.196
                10.162.84.197
                10.162.84.198
                10.162.84.199
                10.162.84.200
                10.162.84.201
                10.162.84.202
                10.162.84.203
                10.162.84.204
                10.162.84.205
                10.162.84.206
                10.162.84.207
                10.162.84.208
                10.162.84.209
                10.162.84.210
                10.162.84.211
                10.162.84.212
                10.162.84.213
                10.162.84.214
                10.162.84.215
                10.162.84.216
                10.162.84.217
                10.162.84.218
                10.162.84.219
                10.162.84.220
                10.162.84.221
                10.162.84.222
                10.162.84.223
                10.162.84.224
                10.162.84.225
                10.162.84.226
                10.162.84.227
                10.162.84.228
                10.162.84.229
                10.162.84.230
                10.162.84.231
                10.162.84.232
                10.162.84.233
                10.162.84.234
                10.162.84.235
                10.162.84.236
                10.162.84.237
                10.162.84.238
                10.162.84.239
                10.162.84.240
                10.162.84.241
                10.162.84.242
                10.162.84.243
                10.162.84.244
                10.162.84.245
                10.162.84.246
                10.162.84.247
                10.162.84.248
                10.162.84.249
                10.162.84.250
                10.162.84.251
                10.162.84.252
                10.162.84.253
                10.162.84.254
                10.162.84.255
	}
        track_script {
                chk_nginx_service
                chk_manual_failover
        }
        notify "/usr/libexec/keepalived/nginx-ha-notify"
}
